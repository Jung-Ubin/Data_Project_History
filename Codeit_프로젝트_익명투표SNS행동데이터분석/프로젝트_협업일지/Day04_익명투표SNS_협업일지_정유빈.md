# Day - 4 협업 일지(고급)

#### 일자: 25-10-16 / 정유빈

---

---

### 팀원들과 논의한 일

- 멘토님의 피드백을 바탕으로 `user_info` 뷰를 다시 만들어봐야겠다 판단
- 테이블을 팀원끼리 조금 더 살펴보고 비즈니스 플로우를 파악을 한 후, 데이터들을 어떤 이유로 제외할지 논리를 보강하여, `user_info`를 다시 정리(inner joun/left,right join 뭘 쓸건지 이런거)

<br>

## \* 오늘 + 내가 한 일

### 테이블 하나씩 뜯어 보기

- 총 테이블 25개를 하나씩 뜯어보며, 멘토님이 조언주신 비즈니스 플로우를 파악해보기

  <br>

#### `accounts_attendance` (출석)테이블 요약

- **데이터 규모**(테이블 내 총 행 수 == 테이블 내 총 유저 수) : 349,637건
- **데이터 목적** : 유저별 출석(Attendance) 내역을 저장하는 테이블
- **NULL 존재 여부** : NULL 값 없음

<br>

- **컬럼 정보**

| 컬럼명                 | 데이터 타입 | 설명                                       | 주요 값 / 특징                           |
| ---------------------- | ----------- | ------------------------------------------ | ---------------------------------------- |
| `id`                   | INT (PK)    | 각 출석 기록의 고유 식별자                 | 중복 없음                                |
| `attendance_date_list` | TEXT        | 유저의 출석 일자를 콤마(,)로 구분한 문자열 | 예: `"2023-04-01,2023-04-02,2023-04-05"` |
| `user_id`              | INT         | 출석을 기록한 유저의 고유 ID               | 총 **349,637명**의 고유 유저 존재        |

<br>

- **테이블 데이터 현황 요약**

| 항목           | 결과                                                         |
| -------------- | ------------------------------------------------------------ |
| 전체 행 수     | **349,637건**                                                |
| 고유 유저 수   | **349,637명** (1:1 매핑 구조)                                |
| NULL 존재 여부 | **없음** (`id`, `attendance_date_list`, `user_id` 전부 유효) |

<br>

- **총 유저 및 출석 횟수 정보**

| 구분                   | 내용                   |
| ---------------------- | ---------------------- |
| 총 유저 수 (중복 제거) | 약 **35만명** (349637) |
| 최소 출석 수           | **1회**                |
| 최대 출석 수           | **310회**              |
| 평균 출석 수           | **6.41회**             |

<br>

- **출석 횟수 분포**

| 출석 횟수 구간 | 유저 수       | 비율(%)  |
| -------------- | ------------- | -------- |
| 0–1회          | 99,812        | 28.5%    |
| 2–5회          | 122,666       | 35.1%    |
| 6–10회         | 64,658        | 18.5%    |
| 11–30회        | 55,189        | 15.8%    |
| 31–100회       | 7,087         | 2.0%     |
| 100회 이상     | 225           | 0.06%    |
| **합계**       | **349,637명** | **100%** |

<br>

- **주요 인사이트 정리**

| 인사이트                                                         | 해석                                               |
| ---------------------------------------------------------------- | -------------------------------------------------- |
| **출석 데이터는 유저 단위 1행 구조로 완결성이 높음**             | → `user_id` 기준으로 조인 시 중복 위험이 거의 없음 |
| **테이블 내 유저들의 평균 출석 6.4회로 전반적 이용 지속도 낮음** | → 다수의 유저가 단기 참여 후 이탈                  |
| **테이블 내 유저들의 출석 10회 이하 유저가 전체의 82% 차지**     | → 앱 내 “장기 활동 유저” 비율이 낮음               |
| **100회 이상 장기 유저는 0.1% 미만**                             | → 극소수 충성 고객층이 존재                        |

---

#### `accounts_blockrecord` (차단 기록)테이블 요약

- **데이터 규모** : 총 194,832건
- **데이터 목적** : 유저 간 “차단(block)” 행위를 기록한 테이블(한 유저(user_id)가 다른 유저(block_user_id)를 차단할 때마다 1행이 생성됨)
- **NULL 존재 여부** : 모든 컬럼에서 NULL 없음

<br>

- **컬럼 정보**

| 컬럼명          | 데이터 타입 | 설명                      | 주요 값 / 특징                                                                                |
| --------------- | ----------- | ------------------------- | --------------------------------------------------------------------------------------------- |
| `id`            | INT (PK)    | 차단 기록의 고유 식별자   | 1부터 순차 증가, 중복 없음                                                                    |
| `reason`        | VARCHAR     | 차단 사유                 | 예시: `"그냥..."`, `"친구 사이가 어색해짐"`, `"나랑 관련 없는 질문을 자꾸 보냄"`, `"기타"` 등 |
| `created_at`    | DATETIME    | 차단 발생 시점            | UTC 기준 시각, 2023년 5월 이후 데이터 집중                                                    |
| `block_user_id` | INT         | 차단을 **당한 유저** ID   | 중복 가능, 총 12,552명의 유저가 한 번 이상 차단당함                                           |
| `user_id`       | INT         | 차단을 **시행한 유저** ID | 중복 가능, 총 16,240명의 유저가 한 번 이상 차단을 수행함                                      |

<BR>

- **테이블 데이터 현황 요약**

| 구분                       | 결과          |
| -------------------------- | ------------- |
| 전체 행 수                 | **194,832건** |
| 차단당한 고유 유저 수      | **12,552명**  |
| 차단을 수행한 고유 유저 수 | **16,240명**  |
| NULL 데이터                | 없음          |

<BR>

- **총 차단 당한 유저 수 및 차단 당한 횟수**

| 구분                              | 내용         |
| --------------------------------- | ------------ |
| 전체 차단당한 유저 수 (중복 제거) | **12,552명** |
| 최대 차단 횟수                    | **171회**    |
| 최소 차단 횟수                    | **1회**      |
| 평균 차단 횟수                    | **1.55회**   |

<br>

- **차단 당한 횟수 분포**

| 차단 횟수 구간 |      유저 수 |      비율(%) |
| -------------- | -----------: | -----------: |
| 1회            |        9,819 | 약 **78.2%** |
| 2 ~ 5회        |        2,429 | 약 **19.4%** |
| 6 ~ 10회       |          224 |  약 **1.8%** |
| 10회 이상      |           80 |  약 **0.6%** |
| **합계**       | **12,552명** |     **100%** |

<br>

- **총 차단을 사용한 유저 수 및 차단 사용 횟수**

| 구분                              | 내용         |
| --------------------------------- | ------------ |
| 차단을 사용한 유저 수 (중복 제거) | **16,240명** |
| 최대 차단 횟수                    | **76회**     |
| 최소 차단 횟수                    | **1회**      |
| 평균 차단 횟수                    | **1.20회**   |

<br>

- **차단 횟수 분포**

| 차단 횟수 구간 |      유저 수 |   비율(%) |
| -------------- | -----------: | --------: |
| 1회            |       14,556 | **89.7%** |
| 2 ~ 5회        |        1,577 |  **9.7%** |
| 6 ~ 10회       |           86 |  **0.5%** |
| 10회 이상      |           21 |  **0.1%** |
| **합계**       | **16,240명** |  **100%** |

<BR>

- **주요 인사이트 요약**

- | 인사이트                                          | 해석                                                    |
  | ------------------------------------------------- | ------------------------------------------------------- |
  | **대부분의 유저는 단 1회 차단 경험만 존재 (90%)** | → 반복적/악성 차단 유저는 매우 소수                     |
  | **평균 차단 횟수 1.2~1.5회로 낮음**               | → 차단 기능이 과도하게 사용되지 않음 (건전한 환경 유지) |

---

#### `accounts_failpaymenthistory` (상품 구매 실패 기록)테이블 요약

- **데이터 규모** : 163건
- **데이터 목적** : 유저의 상품 결제 실패 로그를 저장하는 테이블 A기기와 I기기의 환경에서 결제 실패한 로그들 구분하여 보관
- **NULL 존재 여부** : `productId` 컬럼에서만 NULL 존재 (107건), 나머지 컬럼은 모두 NULL 없음

<br>

- **컬럼 정보**

| 컬럼명       | 데이터 타입 | 설명                         | 주요 값 / 특징                                                                                    |
| ------------ | ----------- | ---------------------------- | ------------------------------------------------------------------------------------------------- |
| `id`         | INT (PK)    | 결제 실패 기록의 고유 식별자 | 1~163 (중복 없음)                                                                                 |
| `productId`  | VARCHAR     | 결제 시도한 상품 ID          | 예시: `'heart.777'`, `'heart.200'`, `'heart.1000'`<br> 단, **107건이 NULL**, iPhone(iOS)에서 발생 |
| `phone_type` | CHAR(1)     | 결제 시도한 디바이스 종류    | `'A'` = Android, `'I'` = iPhone                                                                   |
| `user_id`    | INT         | 결제 실패를 경험한 유저 ID   | 중복 가능, 총 160여 명 정도 존재 (유저별 중복 시도 포함)                                          |

<BR>

- **테이블 데이터 현황 요약**

| 항목                        | 결과                                                  |
| --------------------------- | ----------------------------------------------------- |
| 전체 행 수                  | **163건**                                             |
| 실제 고유 유저              | **160명**(중복 실패 유저 3명(각각 2번씩 실패함) 존재) |
| `productId` 컬럼 NULL 개수  | **107건 (65.6%)**                                     |
| `phone_type` 컬럼 NULL 개수 | 0                                                     |
| `user_id` 컬럼 NULL 개수    | 0                                                     |
| `phone_type` 종류           | `'A'`, `'I'` (Android / iPhone)                       |

<BR>

- `phone_type` 별 유저 수

| 구분                     | 고유 유저 수 | 비율(%) | 특징                                      |
| ------------------------ | ------------ | ------- | ----------------------------------------- |
| Android(`A`)             | **56명**     | **35%** | 상품 정보(`productId`)가 기록됨           |
| iPhone(`I`)              | **104명**    | **65%** | `productId` 대부분 NULL, 실패 로그만 존재 |
| **구매 실패 총 유저 수** | 160명        |         |

<br>

- **Android(A)** 유저의 결제 실패 상품 분포

| product_id     | 실패 횟수 | 비고                                        |
| -------------- | --------: | ------------------------------------------- |
| **heart.777**  |      49회 | 가장 활발히 결제되는 상품으로 실패율도 높음 |
| **heart.1000** |       4회 |                                             |
| **heart.200**  |       3회 |                                             |
| **합계**       |  **56회** |                                             |

<br>

- **iPhone(I)** 유저의 결제 실패 현황

| 항목                   | 설명                                                        |
| ---------------------- | ----------------------------------------------------------- |
| 상품 정보(`productId`) | **전부 NULL**                                               |
| 실패 횟수              | **107건 (전체의 약 65%)**                                   |
| 분석 결과              | 결제 실패와, 결제 시점 로그는 남았으나, 상품 정보 전달 실패 |

<br>

- **주요 인사이트 정리**

| 인사이트                                        | 해석                                                   |
| ----------------------------------------------- | ------------------------------------------------------ |
| 전체 결제 실패 로그는 163건으로 적음            | → **결제 오류는 드문 편으로 보여짐**, 기능 안정성 높음 |
| `productId` NULL 비율 65% (iPhone 중심)         | → iOS 환경에서 상품 정보 로깅 누락 발생                |
| Android에서 `heart.777` 상품 실패율이 가장 높음 | → **구매 시도 자체가 많았기 때문으로 추정**            |
| 모든 컬럼에서 NULL은 `productId`에만 존재       | → 로그 시스템 구조적 문제로 한정된 범위의 결함         |

---

#### `accounts_friendrequest` (친구 요청) 테이블 정보 요약

- **데이터 규모** : 총 17,147,175건 (약 1,700만 행)
- **데이터 목적** : 유저 간 친구 요청 내역(send_user_id → receive_user_id)을 기록하는 관계형 테이블
- **NULL 존재 여부** : 모든 컬럼에서 NULL 없음

<BR>

- **컬럼 정보**

| 컬럼명            | 데이터 타입 | 설명                         | 주요 값 / 특징                                                        |
| ----------------- | ----------- | ---------------------------- | --------------------------------------------------------------------- |
| `id`              | INT (PK)    | 각 친구 요청의 고유 식별자   | 1부터 순차 증가 (중복 없음)                                           |
| `status`          | CHAR(1)     | 친구 요청의 현재 상태        | `'A'` = Accepted(수락), `'R'` = Rejected(거절), `'P'` = Pending(보류) |
| `created_at`      | DATETIME    | 친구 요청이 생성된 시각      | UTC 기준 타임스탬프 (요청 발생 시점 기록)                             |
| `updated_at`      | DATETIME    | 상태가 변경된 시각           | 수락·거절·취소 등 상태 변경이 발생한 시점                             |
| `receive_user_id` | INT         | 친구 요청을 **받은 유저** ID | 중복 가능. 총 660,841명의 고유 유저 존재                              |
| `send_user_id`    | INT         | 친구 요청을 **보낸 유저** ID | 중복 가능. 총 649,072명의 고유 유저 존재                              |

<BR>

- **테이블 데이터 현황 요약**

| 항목                           | 결과                       |
| ------------------------------ | -------------------------- |
| 전체 행 수                     | **17,147,175건**           |
| `receive_user_id` 고유 유저 수 | **660,841명**              |
| `send_user_id` 고유 유저 수    | **649,072명**              |
| 전체 참여 유저(합집합)         | **673,705명**              |
| NULL 존재 여부                 | 모든 컬럼에서 NULL 값 없음 |

<BR>

- **유저 행동 유형 분류**

| 구분                         | 유저 수   | 비율  | 설명                                               |
| ---------------------------- | --------- | ----- | -------------------------------------------------- |
| **받기만 한 유저**           | 24,633명  | 3.6%  | 친구 요청을 한 번도 보내지 않고 **받기만 한 유저** |
| **보내기만 한 유저**         | 12,864명  | 1.9%  | 친구 요청을 받지 않고 **보내기만 한 유저**         |
| **보내기도, 받기도 한 유저** | 636,208명 | 94.4% | 친구 요청을 주고받은 **양방향 유저**               |
| **전체 유저 합계**           | 673,705명 | 100%  | 친구 요청에 관여한 전체 유저                       |

<BR>

- **양방향 유저 대상**(사유: 해당 데이터 테이블에서 94.4%의 비율을 보유) 수락율 분포 확인

| 수락률 구간 | 유저 수       | 비율(%)  | 행동 해석                                            |
| ----------- | ------------- | -------- | ---------------------------------------------------- |
| 0–20%       | 109,399       | 17.2%    | 대부분의 요청을 거절하거나 무시 (비활성/보수적 유저) |
| 20–40%      | 29,576        | 4.6%     | 일부 요청만 수락                                     |
| 40–60%      | 37,067        | 5.8%     | 절반 정도만 수락                                     |
| 60–80%      | 64,053        | 10.1%    | 비교적 활발히 수락                                   |
| 80–99%      | 208,319       | 32.7%    | 대부분 요청 수락                                     |
| 100%        | 187,794       | 29.5%    | 받은 요청 전부 수락 — 개방적/신규 유저               |
| **합계**    | **636,208명** | **100%** | 분석 대상과 일치                                     |

<BR>

- **주요인사이트 정리**

| 주요 인사이트                                                 | 해석                                                         |
| ------------------------------------------------------------- | ------------------------------------------------------------ |
| **대부분(94.4%)의 유저는 친구 요청을 양방향으로 주고받는다.** | → 서비스 내 상호작용이 ‘일방향’보다 ‘상호 교류’ 중심 구조임. |
| **수락률 80% 이상 유저가 62% 이상**                           | → 대다수 유저가 들어온 요청을 거의 모두 수락.                |
| **수락률 0~20% 유저가 17% 존재**                              | → 요청을 거의 수락하지 않거나 비활성 계정 가능성.            |
| **100% 수락 유저는 대부분 소수 요청만 받음**                  | → 신규 유저나 소규모 네트워크 중심 유저일 가능성.            |
| **거절·보류 상태가 일정 비율 존재**                           | → ‘관계 형성 거부/보류’ 행태를 별도 행동 지표로 활용 가능.   |

---

---

## \* 사용했던 코딩

### `accounts_friendrequest` 테이블의 각 유저의 친구 신청 수락률 분석

```sql
WITH
-- 보내기도, 받기도 한 유저 목록
-- 해당 테이블의 유저 기준 94.4%를 차지하여 해당 유저군을 대상으로 분석 진행
both_users AS (
    SELECT DISTINCT s.send_user_id AS user_id
    FROM final.accounts_friendrequest s
    INNER JOIN final.accounts_friendrequest r
        ON s.send_user_id = r.receive_user_id
),

-- 양방향 유저가 받은 요청 상태별 통계
receive_status_summary AS (
    SELECT
        receive_user_id AS user_id,
        SUM(status = 'A') AS accepted_count,
        SUM(status = 'R') AS rejected_count,
        SUM(status = 'P') AS pending_count,
        COUNT(*) AS total_received
    FROM final.accounts_friendrequest
    WHERE receive_user_id IS NOT NULL
    GROUP BY receive_user_id
),

-- 수락률 계산
accept_rate_summary AS (
    SELECT
        r.user_id,
        ROUND(r.accepted_count / r.total_received * 100, 2) AS accept_rate_pct
    FROM receive_status_summary r
    INNER JOIN both_users b ON r.user_id = b.user_id
    WHERE r.total_received > 0
)

-- 수락률 구간별 유저 수 분포
SELECT
    CASE
        WHEN accept_rate_pct < 20 THEN '0–20%'
        WHEN accept_rate_pct < 40 THEN '20–40%'
        WHEN accept_rate_pct < 60 THEN '40–60%'
        WHEN accept_rate_pct < 80 THEN '60–80%'
        WHEN accept_rate_pct < 100 THEN '80–99%'
        WHEN accept_rate_pct = 100 THEN '100%'
    END AS accept_rate_range,
    COUNT(*) AS user_count
FROM accept_rate_summary
GROUP BY accept_rate_range
ORDER BY
    CASE
        WHEN accept_rate_range = '0–20%' THEN 1
        WHEN accept_rate_range = '20–40%' THEN 2
        WHEN accept_rate_range = '40–60%' THEN 3
        WHEN accept_rate_range = '60–80%' THEN 4
        WHEN accept_rate_range = '80–99%' THEN 5
        WHEN accept_rate_range = '100%' THEN 6
    END;
```

---

## \*문제점

- 테이블을 하나씩 살펴보고 있는 중이라 시간이 오래걸리며, 심지어 몇개 살펴보지를 못해서 시간에 쫒길까 불안함
- 활동량이든, 출석률이든, 어떤 포인트를 잡고 유저를 특정 그룹으로 나누어 해당 유저들의 비즈니스 플로우를 보고싶은데, 아직 대부분의 테이블을 확인하지 못하여 정하지 못함

<BR>

## \* 회고

- EDA를 하는 과정이 조금 더 꼼꼼하게 살펴볼 수 있는 연습이 되어서 진행하면서도 공부가 됨
- 멘토님과 강사님이 말씀하신 포인트는 이해가되지만, 아직 테이블이 보여주는 비즈니스 플로우를 정확하게 파악하기 힘듦

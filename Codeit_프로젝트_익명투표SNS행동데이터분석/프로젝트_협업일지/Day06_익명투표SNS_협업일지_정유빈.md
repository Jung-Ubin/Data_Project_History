# Day - 6 협업 일지(고급)

#### 일자: 25-10-20 / 정유빈

---

### 팀원들과 논의한 일

- 각자 테이블들을 살펴본 후 고객들의 비즈니스 플로우 파악하기

<br>

## \* 오늘 + 내가 한 일

## 테이블 하나씩 뜯어 보기

- 총 테이블 25개를 하나씩 뜯어보며, 비즈니스 플로우를 파악해보기

  <br>

---

## `accounts_paymenthistory` (구매 기록 테이블) 정보 정리

- **데이터 규모** : 총 95,140건
- **데이터 목적** : 유저의 **결제 내역**을 저장하는 테이블로, 어떤 상품(`productid`)을 어떤 기기(`phone_type`)에서 언제(`created_at`) 결제했는지를 기록함
- **NULL 존재 여부** : NULL값 없음

<BR>

### 컬럼 정보

| 컬럼명       | 데이터 타입         | 속성                               | 설명                             | 주요 값 / 특징                                       |
| ------------ | ------------------- | ---------------------------------- | -------------------------------- | ---------------------------------------------------- |
| `id`         | BIGINT (PK, NN, AI) | 기본키 / Not Null / Auto Increment | 각 결제 레코드의 고유 식별자     | 중복 없음                                            |
| `productid`  | VARCHAR             | Not Null                           | 구매한 상품의 종류 (하트 패키지) | `heart.200`, `heart.777`, `heart.1000`, `heart.4000` |
| `phone_type` | CHAR(1)             | Not Null                           | 결제 시 사용한 기기 유형         | `A`(Android), `I`(iPhone)                            |
| `created_at` | DATETIME            | Not Null                           | 결제 발생 시각                   | `2023-05-13` ~ `2024-05-08`                          |
| `user_id`    | BIGINT              | Not Null                           | 결제한 유저 ID                   | 59,192명의 고유 유저 존재                            |

<BR>

### 테이블 데이터 현황 요약

| 항목              | 결과                                                 |
| ----------------- | ---------------------------------------------------- |
| 전체 행 수        | **95,140건**                                         |
| 고유 결제 유저 수 | **59,192명**                                         |
| 데이터 수집 기간  | **2023-05-13 ~ 2024-05-08**                          |
| 상품 종류         | `heart.200`, `heart.777`, `heart.1000`, `heart.4000` |
| 기기 종류         | `A(Android)`, `I(iPhone)`                            |
| NULL 존재 여부    | 없음 (모든 주요 컬럼 완전 데이터)                    |

---

### 1. 상품별 판매량 및 비율

| 순위 | 상품ID     | 판매 수량(qty) | 비율(%) |
| ---- | ---------- | -------------- | ------- |
| 1    | heart.777  | 57,873         | 60.83%  |
| 2    | heart.1000 | 19,309         | 20.30%  |
| 3    | heart.200  | 15,822         | 16.63%  |
| 4    | heart.4000 | 2,136          | 2.25%   |

- 총 판매 수량 = **95,140** (테이블 행 수와 일치)

- `heart.777` 상품이 전체 판매의 약 **61%**로 압도적인 주력 상품

<BR>

### 2. 기기별 결제 비율

| 기기        | 결제 건수 | 비율(%) |
| ----------- | --------- | ------- |
| I (iPhone)  | 61,632    | 64.78%  |
| A (Android) | 33,508    | 35.22%  |

- 아이폰 사용자 비중이 약 65%, 안드로이드보다 높음

<BR>

### 3. 한 번만 결제한 유저 특징

| 구분           | 수치     | 비율(%)    |
| -------------- | -------- | ---------- |
| 전체 결제 유저 | 59,192명 | 100%       |
| 1회 결제 유저  | 43,049명 | **72.73%** |
| iPhone         | 26,525명 | 61.62%     |
| Android        | 16,524명 | 38.38%     |

- `약 73%의 유저가 한 번만 결제하고 이탈`, 그중에서도 `iPhone 유저가 절반 이상 차지`

<BR>

### 4. 2회 이상 결제한 유저 특징

| 구분               | 수치     | 비율(%)    |
| ------------------ | -------- | ---------- |
| 전체 결제 유저     | 59,192명 | 100%       |
| 2회 이상 결제 유저 | 16,143명 | **27.27%** |
| iPhone             | 10,778명 | 66.53%     |
| Android            | 5,421명  | 33.47%     |

- 반복 결제 유저는 `전체의 약 27%`, 이 중에서도 `iPhone 유저의 재구매율이 더 높음`

<br>

### 5. 두 번째 결제까지의 평균 소요 시간 (리텐션)

| 항목                  | 결과              |
| --------------------- | ----------------- |
| 2회 이상 결제 유저 수 | 16,143명          |
| 평균 소요 일수        | **4.57일**        |
| 최소 일수             | 0일 (즉시 재결제) |
| 최대 일수             | 360일             |

- 재결제 유저는 평균 `약 4.6일 이내에 두 번째 결제를 진행`하며,
  즉시 재결제(0일 차) 사례도 존재

<br>

### 6. 매출 기준 상위 상품 분석

| productid      | 판매수(qty) | 단가(₩) |           매출(₩) | 매출 비중(%) |
| -------------- | ----------: | ------: | ----------------: | -----------: |
| **heart.777**  |      57,873 |   5,500 |       318,301,500 |   **44.29%** |
| **heart.1000** |      19,309 |  13,000 |       251,017,000 |   **34.93%** |
| **heart.4000** |       2,136 |  49,950 |       106,693,200 |   **14.84%** |
| **heart.200**  |      15,822 |   2,700 |        42,719,400 |    **5.94%** |
| **합계**       |      95,140 |       — | **718,730,100원** |         100% |

- 테이블 내 정보 내에서
- `heart.777`은 **판매량·매출 모두 1위** (`전체 매출의 44.29%`)
- `heart.1000`은 단가가 높지만 수량이 상대적으로 적어 약 35% 수준
- `heart.4000`은 구매 빈도는 낮으나 단가 효과로 전체 매출의 약 15% 차지
- `heart.200`은 진입 상품 역할로 약 6% 정도 기여

<br>

### 주요 인사이트 정리

| 구분                            | 주요 내용                          | 수치 / 비율             | 해석                         |
| ------------------------------- | ---------------------------------- | ----------------------- | ---------------------------- |
| **데이터 규모**                 | 전체 결제 내역 수                  | 95,140건                | 전체 결제 로그와 일치        |
| **고유 결제 유저 수**           | 결제 이력이 있는 고유 유저         | 59,192명                | 중복 제거된 결제 유저        |
| **데이터 수집 기간**            | 최초 ~ 최종 결제 기록              | 2023-05-13 ~ 2024-05-08 | 약 1년간 결제 로그           |
| **상품별 판매량**               | heart.777 / 57,873건               | 60.83%                  | 가장 인기 있는 상품          |
| **기기별 결제 비율**            | iPhone 64.78% / Android 35.22%     | -                       | 아이폰 비중이 높음           |
| **1회 결제 유저 비율**          | 43,049명 / 72.73%                  | -                       | 대다수는 단발 결제 후 이탈   |
| **2회 이상 결제 유저 비율**     | 16,143명 / 27.27%                  | -                       | 재구매 유저 비중 1/4 수준    |
| **2회 이상 유저의 기기 비율**   | iPhone 66.53% / Android 33.47%     | -                       | 아이폰 유저 재구매율 더 높음 |
| **2회 이상 결제까지 평균 일수** | 평균 4.57일 (최소 0일, 최대 360일) | -                       | 빠른 재결제 경향 뚜렷        |
| **매출 비중 1위 상품**          | heart.777 / 578,730,000원          | 59.48%                  | 매출·판매량 모두 1위         |
| **매출 2위 상품**               | heart.1000 / 251,017,000원         | 25.80%                  | 단가 효과로 높은 매출        |
| **NULL 존재 여부**              | 없음                               | -                       | 데이터 완전성 우수           |

---

---

## `accounts_user_contacts` (유저의 네트워크 정보 테이블(연락처, 초대)) 테이블 정보 정리

- **데이터 규모** : 5,063건
- **데이터 목적** : 각 유저의 보유 연락처(친구) 수(`contacts_count`) 및 초대 성공 유저(`invite_user_id_list`) 정보를 기록
- **NULL 존재 여부** : NULL값 존재하지 않음

---

### 컬럼 정보

| 컬럼명                | 데이터 타입 | 속성       | 설명                                       | 주요 값 / 특징                       |
| --------------------- | ----------- | ---------- | ------------------------------------------ | ------------------------------------ |
| `id`                  | BIGINT      | PK, NN, AI | 테이블 고유 식별자                         | 중복 없음                            |
| `contacts_count`      | INT         | NN         | 유저가 보유한 연락처(친구) 수              | 최소 0명 ~ 최대 114명                |
| `invite_user_id_list` | LONGTEXT    | NULL 가능  | 초대한 유저 ID 목록 (콤마로 구분된 문자열) | 예: `'[123,456,789]'`, 일부는 `'[]'` |
| `user_id`             | BIGINT      | NN         | 해당 유저의 ID                             | 고유 유저 수 = 5,063명               |

---

### 테이블 데이터 현황 요약

| 항목           | 결과    |
| -------------- | ------- |
| 전체 행 수     | 5,063   |
| 고유 유저 수   | 5,063   |
| NULL 존재      | 없음    |
| 최대 연락처 수 | 114     |
| 최소 연락처 수 | 0       |
| 평균 연락처 수 | 25.99명 |
| 최대 초대 수   | 10명    |
| 최소 초대 수   | 0명     |
| 평균 초대 수   | 0.33명  |

---

### 1. 해당 테이블에 집계된 연락처(친구) 보유 현황(`contacts_count`컬럼)

| 항목                   | 값      |
| ---------------------- | ------- |
| 친구 0명 유저          | 3명     |
| 전체 대비 비율         | 0.06%   |
| 평균 연락처(친구)\_ 수 | 25.99명 |

- 거의 모든 유저가 최소 1명 이상의 친구를 보유함
- 친구 수가 많을수록 초대 성공률이 증가하는 경향이 보여짐

---

### 2. 초대 성공 현황

| 항목                        | 값      |
| --------------------------- | ------- |
| 초대 성공 인원이 0명인 유저 | 3,905명 |
| 전체 대비 비율              | 77.13%  |
| 초대 성공 유저 수           | 1,158명 |
| 평균 초대 성공 수           | 0.33명  |

- 대부분의 유저는 초대를 실패함
- 해당 테이블에 기록된 “**초대를 사용한 유저**”의 약 **22%만이 실제 초대를 성공**시킴

---

### 3. 친구 수 구간별 초대율 비교

| 연락처(친구) 수 구간 | 유저 수 | 초대 성공 유저 수 | 초대 성공율(%) | 해석                                       |
| -------------------- | ------- | ----------------- | -------------- | ------------------------------------------ |
| 0명                  | 3       | 0                 | 0.00           | 친구가 없는 유저는 초대를 하지 않음        |
| 1~10명               | 482     | 47                | **9.75**       | 소규모 네트워크에서도 일부 초대 활동 존재  |
| 11~30명              | 2,992   | 545               | **18.22**      | 일정 친구 수 확보 시 초대 가능성 상승      |
| 31명 이상            | 1,586   | 566               | **35.69**      | 친구 수가 많을수록 초대 기능 활용도가 높음 |

- 친구 수가 **30명을 넘어가는 순간 초대율이 급격히 상승함**
- **네트워크 규모가 클수록 서비스 확산력이 커짐**을 시사

---

### 4. 초대 성공 유저 분석

- `invite_user_id_list` 컬럼에 1명 이상 초대한 유저 한정 분석 (1,158명 기준)

| 구분                                  | 평균 친구 수 | 평균 초대 성공 수 |
| ------------------------------------- | ------------ | ----------------- |
| **Top 10 (가장 많이 초대한 유저)**    | 61.50명      | 6.50명            |
| **Bottom 10 (가장 적게 초대한 유저)** | 4.70명       | 1.00명            |

- 상위권 유저는 평균적으로 **친구 60명 이상, 초대 6명 이상 성공**
- 하위권 유저는 **친구 수와 초대 성공 수 모두 낮음 → 활동성 편차 뚜렷**

---

### 주요 인사이트

| 구분                   | 인사이트 내용                                                      |
| ---------------------- | ------------------------------------------------------------------ |
| **유저 네트워크 구조** | 대부분의 유저는 친구 네트워크를 보유하고 있으며, 0명 유저는 극소수 |
| **초대 행동 분포**     | 전체의 77%는 초대 시도 없음 → “핵심 확산 유저”가 소수에 집중       |
| **관계 밀도 효과**     | 친구 수가 많을수록 초대 성공률이 가파르게 증가                     |
| **활동 편차**          | Top10 유저의 초대 성과가 Bottom10보다 약 6배 이상 높음             |

---

### ❓ 여기서 드는 의문

- 실제로 `accounts_user_contacts` 테이블에 해당되는 유저들은 **초대를 사용한 유저들이 기록되는 것인지?**
- **초대를 성공한 유저들만** `invite_user_id_list`에 표시되고, **초대는 시도했지만 실패한 유저는 `[]`로 표시되는 것인지?**
- 다른 테이블의 데이터 규모(or 고유 유저 수)는 매우 큰데, **본 테이블에는 약 5천 건만 존재**  
  → 초대 행동이 이렇게까지 적게 나타난다고? 내가 설정한 가설로 사용해도 되는지?  
  (`accounts_user_contacts`의 유저들은 내가 생각했던 초대를 사용한 유저가 아닌 **다른 기준이 있는건가?**)

---

### 의문점 확인

- 내가 이해하고, 설정했던 가정들

1. `accounts_user_contacts`는 “초대 기능을 시도한 유저”들의 기록 테이블이다.
2. 초대 성공 시 `invite_user_id_list`에 실제 초대한 유저 ID가 기록된다. (초대성공: 초대 링크를 수락하고 회원 가입까지 성공한 유저)
3. 초대를 시도했으나 실패한 유저는 `invite_user_id_list = '[]'` 형태로 남는다.

**검증 근거**

1. 이벤트 테이블인 `hackle_events` 사용 (`click_friend_invite`, `click_invite_friend` 컬럼 사용)

- hackle_events의 전체 데이터 행 수 : 11,441,319건 (약 1,100만 건)
- 데이터 수집 기간은 다르지만, 유저의 실제 **초대 행동 로그** 데이터가 존재함
- 데이터의 규모를 서로 비교하며, 확인해볼 가치가 있다고 판단
- 각 테이블의 데이터 수집 기간이 차이가 있으므로, 어느정도 수치 차이가 난다고 판단

| 검증 항목                                                                           | 결과    |
| ----------------------------------------------------------------------------------- | ------- |
| `hackle_events`의 초대 관련 로그(`click_friend_invite`, `click_invite_friend`) 총합 | 4,275건 |
| `accounts_user_contacts` 테이블 전체 행 수                                          | 5,063건 |
| 규모 유사 → **초대 시도 유저 기록 테이블로 볼 수 있다고 판단함**                    |

<br>

2. `accounts_user` 테이블의 `id`, `friend_id_list` 컬럼 활용

- `accounts_user_contacts.user_id` → `accounts_user.id` : **100% 매칭 성공 (5,063건)**
- 초대 성공 유저(1,158명) 중 **1,156명(99.83%)**이 실제 `friend_id_list` 내 존재  
  → **초대한 관계가 실제 친구 관계로 이어짐**

---

### 결론 요약

1. `accounts_user_contacts`는 전체 유저가 아닌 **“초대 기능을 시도한 유저”들의 기록 테이블**이다
2. 초대 성공(`invite_user_id_list`)은 실제 친구 관계(`friend_id_list`)에도 반영되어 있다
3. `hackle_events`의 초대 관련 행동 수(4,275건)가 테이블 규모(5,063건)와 유사하므로, **초대 기능을 사용한 유저만 집계된 테이블일 가능성이 매우 높다**
4. 따라서 본 테이블은 **“초대 기능을 시도하고, 일부는 성공한 유저군”을 나타내는 것으로 보여진다**

---

---

## \* 사용했던 코딩

### `accounts_user_contacts`테이블의 `user_id`가 `accounts_user`테이블의 `id`와 얼마나 매칭되는지 확인

```sql
SELECT
    COUNT(*) AS total_contact_users,                                   -- accounts_user_contacts 전체 유저 수
    SUM(au.id IS NOT NULL) AS matched_in_accounts_user,                -- accounts_user에 존재하는 매칭된 유저 수
    SUM(au.id IS NULL) AS not_matched,                                 -- 매칭되지 않은 유저 수
    ROUND(SUM(au.id IS NOT NULL) * 100.0 / COUNT(*), 2) AS match_rate_pct -- 매칭 비율(%)
FROM final.accounts_user_contacts AS uc
LEFT JOIN final.accounts_user AS au
    ON uc.user_id = au.id;
```

---

---

## \*문제점

- 테이블을 하나씩 뜯어보고 있지만, 해당 과정을 실수없이 진행을 하고 있는 것인지, 걱정이 된다.
- 여전히 SQL 쿼리 작성 능력이 부족하여 연습이 많이 필요하다는걸 느끼고 있다. 잘하고싶다...

<BR>

## \* 회고

- SQL을 다루는 과정은 여전히 흥미롭다.  
  데이터를 직접 탐색하면서 새로운 인사이트를 발견하는 순간이 특히 즐겁고,  
  분석의 방향성을 구체화해가는 과정 자체가 큰 공부가 된다.

<BR>

- 하지만 머릿속으로 분석 방향이 잡혀 있어도,  
  막상 쿼리를 작성할 때 문법적인 부분이나 구조 설계에서 막히는 경우가 많았다.  
  생각이 코드로 자연스럽게 이어지지 않는다는 점이 스스로 느껴진다.

<BR>

- 앞으로는 단순히 ‘무엇을 분석할까’뿐 아니라  
  ‘어떻게 SQL로 구현할까’를 훈련해야겠다.  
  즉, 쿼리 작성 속도와 구조 설계 능력을 꾸준히 키워야겠다.
